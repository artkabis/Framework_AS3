package fr.artkabis.utils
{
	import flash.display.DisplayObject;
	import flash.events.Event;
	import flash.events.MouseEvent;
	import flash.utils.setTimeout;
	import flash.utils.clearTimeout;
	
	//======================================================================================================================================================================================================================
	//======================================PUBLIC CLASS====================================================================================================================================================================
	//======================================================================================================================================================================================================================
	public class InertieMouse
	{
		private var _obj         :Object;
		private var _inertie     :Number;
		private var _cible       :DisplayObject;
		public const VERSION     :Number = 1.0;
		
		//================================================================================================
		//======================================GETTER__SETTER============================================
		//================================================================================================
		//************************************************************************************************
		/**/ public function get obj():Object{return _obj};                                            //*
		/**/ public function set obj($obj:Object){_obj = $obj;this.start()};                           //*
		/**/                                                                                           //*
		/**/ public function get inertie():Number{return _inertie;}                                    //*
		/**/ public function set inertie($inert:Number){_inertie =  initInertie($inert);this.start();} //*
		/**/                                                                                           //*
		/**/ public function get version():Number{return VERSION};                                     //*
		/**/                                                                                           //*
		//================================================================================================
		//================================================================================================
		
		//=================================================================================================================================================================================================================
		//======================================CONSTRUCTOR================================================================================================================================================================
		//=================================================================================================================================================================================================================
		public function InertieMouse( $obj:Object , $inertie:Number )
		{
			_obj     = $obj;
			_inertie = initInertie($inertie);
			
			trace('::____InertieMouse_V1.0 by Artkabis____::');
		}
		//=================================================================================================================================================================================================================
		//======================================START INERTIE==============================================================================================================================================================
		//=================================================================================================================================================================================================================
		public function start()  :void
		{
			_cible =  _obj as DisplayObject;
			_cible.stage.addEventListener( Event.MOUSE_LEAVE, desactiv );
			_cible.stage.addEventListener( MouseEvent.MOUSE_MOVE, activ );
			_cible.stage.addEventListener( Event.ENTER_FRAME, deplace );
		}
		//=================================================================================================================================================================================================================
		//======================================PRIVATE====================================================================================================================================================================
		//=================================================================================================================================================================================================================
		public function desactiv( e:Event )
		{
			var _time = _cible.stage.frameRate / _inertie;
			var out   = setTimeout(
									 function():void
									 {
										_cible.stage.removeEventListener(Event.ENTER_FRAME,deplace); 
										clearTimeout(out);
									 }
									 ,_time
								)
			trace(_time+'ms to delete enterFrame');
			
		}
		//=================================================================================================================================================================================================================
		//=================================================================================================================================================================================================================
		private function activ( me:MouseEvent )  :void
		{
			_cible.stage.addEventListener( Event.ENTER_FRAME,deplace );
		}
		//=================================================================================================================================================================================================================
		//=================================================================================================================================================================================================================
		private function deplace( e:Event )  :void
		{
			_cible.x += ( _cible.stage.mouseX - _cible.x )* _inertie;
			_cible.y += ( _cible.stage.mouseY - _cible.y )* _inertie;
		}
		//=================================================================================================================================================================================================================
		//=================================================================================================================================================================================================================
		private function initInertie( $inert:Number )  :Number
		{
			var _inert = ( $inert / 100 ) % 10;
			if( _inert == Infinity ){ _inert=.1; }
			return _inert;
		}
	}
}